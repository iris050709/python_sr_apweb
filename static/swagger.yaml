openapi: 3.0.0
info:
  title: User API
  description: API para la gestión de usuarios y datos de IoT.
  version: 1.0.0

servers:
  - url: https://3.145.63.126/users/
    description: Servidor local

paths:
  # Rutas de usuarios
  /:
    get:
      summary: Obtener todos los usuarios
      responses:
        '200':
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    nombre:
                      type: string
                    correo:
                      type: string
                    rol:
                      type: string
                      enum:
                        - Administrador
                        - Usuario
                    fecha_nacimiento:
                      type: string
                      format: date
                    sexo:
                      type: string
                      enum:
                        - Femenino
                        - Masculino
                    foto:
                      type: string
                      format: uri
                      nullable: true
        '400':
          description: Solicitud incorrecta
        '500':
          description: Error en el servidor
    post:
      summary: Crear un nuevo usuario
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                nombre:
                  type: string
                correo:
                  type: string
                password:
                  type: string
                rol:
                  type: string
                  enum:
                    - Administrador
                    - Usuario
                fecha_nacimiento:
                  type: string
                  format: date
                sexo:
                  type: string
                  enum:
                    - Femenino
                    - Masculino
                foto:
                  type: string
                  format: binary
                  nullable: true
      responses:
        '201':
          description: Usuario creado
        '400':
          description: Error en los datos proporcionados
        '500':
          description: Error en el servidor
  /{user_id}:
    get:
      summary: Obtener un usuario por ID
      parameters:
        - name: user_id
          in: path
          required: true
          description: ID del usuario
          schema:
            type: integer
      responses:
        '200':
          description: Información del usuario
        '404':
          description: Usuario no encontrado
        '500':
          description: Error en el servidor
    put:
      summary: Actualizar un usuario por ID
      parameters:
        - name: user_id
          in: path
          required: true
          description: ID del usuario
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nombre:
                  type: string
                correo:
                  type: string
                password:
                  type: string
                rol:
                  type: string
                  enum:
                    - Administrador
                    - Usuario
                fecha_nacimiento:
                  type: string
                  format: date
                sexo:
                  type: string
                  enum:
                    - Femenino
                    - Masculino
      responses:
        '200':
          description: Usuario actualizado
        '400':
          description: Error en los datos proporcionados
        '404':
          description: Usuario no encontrado
        '500':
          description: Error en el servidor
    delete:
      summary: Eliminar un usuario por ID
      parameters:
        - name: user_id
          in: path
          required: true
          description: ID del usuario
          schema:
            type: integer
      responses:
        '200':
          description: Usuario eliminado
        '404':
          description: Usuario no encontrado
        '500':
          description: Error en el servidor
  /check-email:
    post:
      summary: Verificar si un correo está registrado
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                correo:
                  type: string
      responses:
        '200':
          description: Resultado de la verificación del correo
          content:
            application/json:
              schema:
                type: object
                properties:
                  exists:
                    type: boolean
        '400':
          description: El campo correo es obligatorio
        '500':
          description: Error en el servidor
  /login:
    post:
      summary: Iniciar sesión con correo y contraseña
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                correo:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: Respuesta de inicio de sesión exitoso
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        '400':
          description: Error de autenticación
        '500':
          description: Error en el servidor
  
  # Nuevas rutas para los datos de IoT
  /iot/datos:
    get:
      summary: Obtener todos los registros de sensores
      responses:
        '200':
          description: Lista de registros de sensores
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    nivel_temperatura1:
                      type: number
                      format: float
                    estado_ventilador1:
                      type: string
                    nivel_temperatura2:
                      type: number
                      format: float
                    estado_ventilador2:
                      type: string
                    luz:
                      type: boolean
                    estado_led:
                      type: string
                    agua_detectada:
                      type: boolean
                    posicion_servo:
                      type: number
                      format: float
                    humedad_suelo1:
                      type: number
                      format: float
                    estado_bomba1:
                      type: string
                    estado_bomba2:
                      type: string
                    distancia1:
                      type: number
                      format: float
                    humedad_suelo2:
                      type: number
                      format: float
                    estado_bomba3:
                      type: string
                    estado_bomba4:
                      type: string
                    distancia2:
                      type: number
                      format: float
        '500':
          description: Error en el servidor
    post:
      summary: Crear un nuevo registro de sensor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nivel_temperatura1:
                  type: number
                  format: float
                estado_ventilador1:
                  type: string
                nivel_temperatura2:
                  type: number
                  format: float
                estado_ventilador2:
                  type: string
                luz:
                  type: boolean
                estado_led:
                  type: string
                agua_detectada:
                  type: boolean
                posicion_servo:
                  type: number
                  format: float
                humedad_suelo1:
                  type: number
                  format: float
                estado_bomba1:
                  type: string
                estado_bomba2:
                  type: string
                distancia1:
                  type: number
                  format: float
                humedad_suelo2:
                  type: number
                  format: float
                estado_bomba3:
                  type: string
                estado_bomba4:
                  type: string
                distancia2:
                  type: number
                  format: float
      responses:
        '201':
          description: Registro de sensor creado
        '400':
          description: Error en los datos proporcionados
        '500':
          description: Error en el servidor

  /iot/datos/{dato_id}:
    get:
      summary: Obtener un registro de sensor por ID
      parameters:
        - name: dato_id
          in: path
          required: true
          description: ID del registro de sensor
          schema:
            type: integer
      responses:
        '200':
          description: Información del registro de sensor
        '404':
          description: Registro de sensor no encontrado
        '500':
          description: Error en el servidor
    put:
      summary: Actualizar un registro de sensor por ID
      parameters:
        - name: dato_id
          in: path
          required: true
          description: ID del registro de sensor
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nivel_temperatura1:
                  type: number
                  format: float
                estado_ventilador1:
                  type: string
                nivel_temperatura2:
                  type: number
                  format: float
                estado_ventilador2:
                  type: string
                luz:
                  type: boolean
                estado_led:
                  type: string
                agua_detectada:
                  type: boolean
                posicion_servo:
                  type: number
                  format: float
                humedad_suelo1:
                  type: number
                  format: float
                estado_bomba1:
                  type: string
                estado_bomba2:
                  type: string
                distancia1:
                  type: number
                  format: float
                humedad_suelo2:
                  type: number
                  format: float
                estado_bomba3:
                  type: string
                estado_bomba4:
                  type: string
                distancia2:
                  type: number
                  format: float
      responses:
        '200':
          description: Registro de sensor actualizado
        '400':
          description: Error en los datos proporcionados
        '404':
          description: Registro de sensor no encontrado
        '500':
          description: Error en el servidor
    delete:
      summary: Eliminar un registro de sensor por ID
      parameters:
        - name: dato_id
          in: path
          required: true
          description: ID del registro de sensor
          schema:
            type: integer
      responses:
        '200':
          description: Registro de sensor eliminado
        '404':
          description: Registro de sensor no encontrado
        '500':
          description: Error en el servidor
